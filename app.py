import streamlit as st
import google.generativeai as genai
import os

# 1. ุฅุนุฏุงุฏ ุงูุตูุญุฉ
st.set_page_config(
    page_title="ุงูููุตููู ุงููุถุงุฆู ุงูุขูู",
    page_icon="โ๏ธ",
    layout="centered",
    initial_sidebar_state="collapsed"
)

# 2. ุงูุชุญูู ูู ููุชุงุญ API ูุชุดุบููู
# ูุญุงูู ุงูููุฏ ุฌูุจ ุงูููุชุงุญ ูู ุฃุณุฑุงุฑ Streamlit ุฃู ูุชุบูุฑุงุช ุงูุจูุฆุฉ
api_key = os.environ.get("GOOGLE_API_KEY")
if not api_key:
    try:
        api_key = st.secrets["GOOGLE_API_KEY"]
    except FileNotFoundError:
        st.error("โ๏ธ ูู ูุชู ุงูุนุซูุฑ ุนูู ููุชุงุญ API. ุงูุฑุฌุงุก ุฅุถุงูุชู ูู ุฅุนุฏุงุฏุงุช Streamlit Secrets ุจุงุณู 'GOOGLE_API_KEY'.")
        st.stop()

genai.configure(api_key=api_key)

# 3. ุฅุนุฏุงุฏ ูููุฐุฌ ุงูุฐูุงุก ุงูุงุตุทูุงุนู
generation_config = {
  "temperature": 0.4,
  "top_p": 0.95,
  "top_k": 64,
  "max_output_tokens": 8192,
}

# ูุณุชุฎุฏู gemini-1.5-flash ูุณุฑุนุชู ูููุงุกุชู ูู ุงูุชุตููู
model = genai.GenerativeModel(
  model_name="gemini-1.5-flash",
  generation_config=generation_config,
)

# 4. ูุงุฌูุฉ ุงููุณุชุฎุฏู
st.markdown("""
<div style="text-align: center;">
    <h1>โ๏ธ ุงูููุตููู ุงููุถุงุฆู ุงูุขูู</h1>
    <p style="color: gray;">ูุธุงู ุฐูู ููุฑุฒ ูุชุตููู ุตุญุงุฆู ุงูุฏุนูู ูุชูุฌูููุง ูููุญููุฉ ุงููุฎุชุตุฉ</p>
</div>
""", unsafe_allow_html=True)

st.markdown("---")

# ุฅุฏุฎุงู ุงููุต
lawsuit_text = st.text_area(
    "ูุต ุตุญููุฉ ุงูุฏุนูู:", 
    height=200, 
    placeholder="ุงูุชุจ ุชูุงุตูู ุงูุฏุนูู ููุง (ูุซูุงู: ุฃุทุงูุจ ุงูุดุฑูุฉ ุจุฑูุงุชุจ ูุชุฃุฎุฑุฉ... ุฃู: ุฃุฑูุฏ ูุณุฎ ุนูุฏ ุงูููุงุญ...)"
)

# ุฒุฑ ุงูุชุญููู
if st.button("๐ ุชุญููู ูุชุตููู ุงูุฏุนูู", type="primary", use_container_width=True):
    if not lawsuit_text:
        st.warning("ุงูุฑุฌุงุก ุฅุฏุฎุงู ูุต ุงูุฏุนูู ุฃููุงู.")
    else:
        with st.spinner('ุฌุงุฑู ุงุณุชุดุงุฑุฉ ุงูุฐูุงุก ุงูุงุตุทูุงุนู ูุชุญููู ุงููุต ูุงููููุงู...'):
            try:
                # ุชุตููู ุงูุฃูุฑ (Prompt) ููููู ุฏูููุงู
                prompt = f"""
                ุฃูุช ูุณุงุนุฏ ูุงูููู ูุชุฎุตุต ูู ุงููุธุงู ุงููุถุงุฆู ุงูุณุนูุฏู. ูู ุจุชุญููู ูุต ุงูุฏุนูู ุงูุชุงูู ุจุฏูุฉ:
                
                ูุต ุงูุฏุนูู: "{lawsuit_text}"
                
                ุงููุทููุจ ููู ุงุณุชุฎุฑุงุฌู ูุนุฑุถู:
                1. **ููุน ุงูุฏุนูู**: (ุชุฌุงุฑูุฉุ ุนูุงููุฉุ ุฃุญูุงู ุดุฎุตูุฉุ ุนุงูุฉุ ุฌุฒุงุฆูุฉุ ุฅูุฎ).
                2. **ุงููุญููุฉ ุงููุฎุชุตุฉ**: ุงููุญููุฉ ุงูุชู ูุฌุจ ููุฏ ุงูุฏุนูู ูููุง.
                3. **ุฏุฑุฌุฉ ุงูุงุณุชุนุฌุงู**: (ุนุงุฏูุฉุ ูุณุชุนุฌูุฉ) ูุน ุฐูุฑ ุงูุณุจุจ ุจุงุฎุชุตุงุฑ.
                4. **ุงูุฃุณุงููุฏ ุงููุญุชููุฉ**: ุงูุฃูุธูุฉ ุฃู ุงูููุงุฆุญ ุงูุชู ูุฏ ุชุณุชูุฏ ุนูููุง ูุฐู ุงูุฏุนูู.
                5. **ูุฏู ุงูุงูุชูุงู**: ูู ุชุจุฏู ุงูุฏุนูู ููุชููุฉ ุงูุฃุฑูุงู (ุฃุทุฑุงูุ ููุถูุนุ ุทูุจุงุช) ุฃู ููุงู ููุงูุต ูุงุถุญุฉุ
                
                ุงุฌุนู ุงูุฅุฌุงุจุฉ ููุณูุฉ ููุงุถุญุฉ ุจุงููุบุฉ ุงูุนุฑุจูุฉ.
                """
                
                # ุทูุจ ุงูุงุณุชุฌุงุจุฉ ูู ุงููููุฐุฌ
                response = model.generate_content(prompt)
                
                # ุนุฑุถ ุงููุชุงุฆุฌ
                st.success("ุชู ุงูุชุตููู ุจูุฌุงุญ!")
                st.markdown("### ๐ ุชูุฑูุฑ ุงูุชุญููู ุงูุขูู:")
                st.markdown(response.text)
                
            except Exception as e:
                st.error(f"ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุงุชุตุงู ุจุงูุฎุงุฏู: {e}")

# ุชุฐููู
st.markdown("---")
st.caption("ุชู ุงูุชุทููุฑ ุจุงุณุชุฎุฏุงู Google Gemini AI & Streamlit")
